{
  "section": 18,
  "title": "Form Composition Patterns",
  "metadata": {
    "startLine": 6155,
    "endLine": 6573,
    "codeBlockCount": 8,
    "tableCount": 0,
    "extractedAt": "2025-12-01T16:35:09.319Z"
  },
  "codeBlocks": [
    {
      "id": "code-18-0",
      "language": "tsx",
      "code": "import { useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport Button from '@/components/ui/Button';\nimport TextField from '@/components/ui/TextField';\nimport Card from '@/components/ui/Card';\nimport { toast } from '@/components/ui/Toast';\n\ninterface ProfileFormData {\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n}\n\nconst ProfileForm = () => {\n  const [loading, setLoading] = useState(false);\n  const { register, handleSubmit, formState: { errors } } = useForm<ProfileFormData>();\n\n  const onSubmit = async (data: ProfileFormData) => {\n    setLoading(true);\n    try {\n      await api.updateProfile(data);\n      toast.show({\n        type: 'success',\n        title: 'Profile Updated',\n        message: 'Your profile has been updated successfully.',\n      });\n    } catch (error) {\n      toast.show({\n        type: 'error',\n        title: 'Update Failed',\n        message: error.message,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Card variant=\"default\" padding=\"lg\">\n      <h2 className=\"text-2xl font-bold text-white mb-6\">Profile Information</h2>\n\n      <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n        {/* Field Group: Name */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <TextField\n            name=\"firstName\"\n            label=\"First Name\"\n            placeholder=\"John\"\n            error={!!errors.firstName}\n            errorMessage={errors.firstName?.message}\n            {...register('firstName', { required: 'First name is required' })}\n          />\n          <TextField\n            name=\"lastName\"\n            label=\"Last Name\"\n            placeholder=\"Doe\"\n            error={!!errors.lastName}\n            errorMessage={errors.lastName?.message}\n            {...register('lastName', { required: 'Last name is required' })}\n          />\n        </div>\n\n        {/* Field Group: Contact */}\n        <div className=\"space-y-4\">\n          <TextField\n            name=\"email\"\n            label=\"Email Address\"\n            type=\"email\"\n            placeholder=\"john@example.com\"\n            error={!!errors.email}\n            errorMessage={errors.email?.message}\n            {...register('email', {\n              required: 'Email is required',\n              pattern: {\n                value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,\n                message: 'Invalid email address',\n              },\n            })}\n          />\n          <TextField\n            name=\"phone\"\n            label=\"Phone Number\"\n            type=\"tel\"\n            placeholder=\"+91 98765 43210\"\n            error={!!errors.phone}\n            errorMessage={errors.phone?.message}\n            {...register('phone', {\n              required: 'Phone is required',\n              pattern: {\n                value: /^[+]?[0-9]{10,15}$/,\n                message: 'Invalid phone number',\n              },\n            })}\n          />\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex justify-end space-x-3 pt-4\">\n          <Button variant=\"ghost\" type=\"button\">\n            Cancel\n          </Button>\n          <Button variant=\"primary\" type=\"submit\" isLoading={loading}>\n            Save Changes\n          </Button>\n        </div>\n      </form>\n    </Card>\n  );\n};",
      "lineNumber": 6172
    },
    {
      "id": "code-18-1",
      "language": "tsx",
      "code": "import { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ninterface KYCWizardProps {\n  onComplete: (data: KYCData) => void;\n}\n\nconst KYCWizard: React.FC<KYCWizardProps> = ({ onComplete }) => {\n  const [step, setStep] = useState(1);\n  const [formData, setFormData] = useState({});\n\n  const steps = [\n    { id: 1, title: 'Entity Type', component: EntityTypeStep },\n    { id: 2, title: 'Basic Details', component: BasicDetailsStep },\n    { id: 3, title: 'Documents', component: DocumentsStep },\n    { id: 4, title: 'Bank Details', component: BankDetailsStep },\n    { id: 5, title: 'Review', component: ReviewStep },\n  ];\n\n  const currentStep = steps.find(s => s.id === step);\n  const CurrentStepComponent = currentStep?.component;\n\n  const handleNext = (stepData: any) => {\n    setFormData({ ...formData, ...stepData });\n    if (step < steps.length) {\n      setStep(step + 1);\n    } else {\n      onComplete({ ...formData, ...stepData });\n    }\n  };\n\n  const handleBack = () => {\n    if (step > 1) setStep(step - 1);\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n      {/* Progress Indicator */}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          {steps.map((s, index) => (\n            <div key={s.id} className=\"flex items-center\">\n              <div className={`\n                w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all\n                ${step > s.id\n                  ? 'bg-green-500 text-white'\n                  : step === s.id\n                  ? 'bg-blue-500 text-white ring-4 ring-blue-500/30'\n                  : 'bg-white/10 text-white/50'\n                }\n              `}>\n                {step > s.id ? '✓' : s.id}\n              </div>\n              {index < steps.length - 1 && (\n                <div className={`\n                  w-20 h-1 mx-2 transition-all\n                  ${step > s.id ? 'bg-green-500' : 'bg-white/10'}\n                `} />\n              )}\n            </div>\n          ))}\n        </div>\n        <p className=\"text-center text-white/70\">\n          Step {step} of {steps.length}: {currentStep?.title}\n        </p>\n      </div>\n\n      {/* Step Content */}\n      <AnimatePresence mode=\"wait\">\n        <motion.div\n          key={step}\n          initial={{ opacity: 0, x: 20 }}\n          animate={{ opacity: 1, x: 0 }}\n          exit={{ opacity: 0, x: -20 }}\n          transition={{ duration: 0.3 }}\n        >\n          <Card variant=\"default\" padding=\"lg\">\n            {CurrentStepComponent && (\n              <CurrentStepComponent\n                data={formData}\n                onNext={handleNext}\n                onBack={handleBack}\n                isFirstStep={step === 1}\n                isLastStep={step === steps.length}\n              />\n            )}\n          </Card>\n        </motion.div>\n      </AnimatePresence>\n    </div>\n  );\n};",
      "lineNumber": 6289
    },
    {
      "id": "code-18-2",
      "language": "tsx",
      "code": "// Fieldset component for logical grouping\nconst FieldGroup = ({ title, description, children }) => {\n  return (\n    <div className=\"p-6 bg-white/5 rounded-xl border border-white/10\">\n      <div className=\"mb-4\">\n        <h3 className=\"text-lg font-semibold text-white\">{title}</h3>\n        {description && (\n          <p className=\"text-sm text-white/60 mt-1\">{description}</p>\n        )}\n      </div>\n      <div className=\"space-y-4\">\n        {children}\n      </div>\n    </div>\n  );\n};\n\n// Usage\n<form className=\"space-y-6\">\n  <FieldGroup\n    title=\"Personal Information\"\n    description=\"Your basic details for identification\"\n  >\n    <TextField name=\"fullName\" label=\"Full Name\" />\n    <TextField name=\"dob\" label=\"Date of Birth\" type=\"date\" />\n  </FieldGroup>\n\n  <FieldGroup\n    title=\"Contact Information\"\n    description=\"How we can reach you\"\n  >\n    <TextField name=\"email\" label=\"Email\" type=\"email\" />\n    <TextField name=\"phone\" label=\"Phone\" type=\"tel\" />\n  </FieldGroup>\n\n  <FieldGroup\n    title=\"Address\"\n    description=\"Your residential address\"\n  >\n    <TextField name=\"street\" label=\"Street Address\" />\n    <div className=\"grid grid-cols-2 gap-4\">\n      <TextField name=\"city\" label=\"City\" />\n      <TextField name=\"pincode\" label=\"PIN Code\" />\n    </div>\n  </FieldGroup>\n</form>",
      "lineNumber": 6388
    },
    {
      "id": "code-18-3",
      "language": "tsx",
      "code": "// Using react-hook-form\nimport { useForm } from 'react-hook-form';\n\nconst { register, handleSubmit, formState: { errors }, watch } = useForm({\n  mode: 'onBlur', // Validate on blur\n});\n\n// Field validation rules\n<TextField\n  {...register('pan', {\n    required: 'PAN is required',\n    pattern: {\n      value: /^[A-Z]{5}[0-9]{4}[A-Z]$/,\n      message: 'Invalid PAN format (e.g., ABCDE1234F)',\n    },\n    validate: async (value) => {\n      // Custom async validation\n      const isValid = await api.validatePAN(value);\n      return isValid || 'PAN verification failed';\n    },\n  })}\n/>",
      "lineNumber": 6442
    },
    {
      "id": "code-18-4",
      "language": "tsx",
      "code": "const PANField = () => {\n  const [isValidating, setIsValidating] = useState(false);\n  const [isValid, setIsValid] = useState<boolean | null>(null);\n\n  const handleValidate = async (value: string) => {\n    if (value.length === 10) {\n      setIsValidating(true);\n      try {\n        const result = await api.validatePAN(value);\n        setIsValid(result.valid);\n      } finally {\n        setIsValidating(false);\n      }\n    }\n  };\n\n  return (\n    <div className=\"relative\">\n      <TextField\n        name=\"pan\"\n        label=\"PAN Number\"\n        placeholder=\"ABCDE1234F\"\n        onChange={(e) => handleValidate(e.target.value)}\n      />\n      {isValidating && (\n        <div className=\"absolute right-3 top-10\">\n          <Loader className=\"h-5 w-5 text-blue-400 animate-spin\" />\n        </div>\n      )}\n      {isValid === true && (\n        <div className=\"absolute right-3 top-10\">\n          <CheckCircle className=\"h-5 w-5 text-green-400\" />\n        </div>\n      )}\n      {isValid === false && (\n        <div className=\"absolute right-3 top-10\">\n          <XCircle className=\"h-5 w-5 text-red-400\" />\n        </div>\n      )}\n    </div>\n  );\n};",
      "lineNumber": 6468
    },
    {
      "id": "code-18-5",
      "language": "tsx",
      "code": "<div className=\"flex items-center justify-between pt-6 border-t border-white/10\">\n  {/* Left: Secondary Actions */}\n  <div className=\"flex space-x-3\">\n    <Button variant=\"ghost\" type=\"button\" onClick={handleSaveDraft}>\n      Save Draft\n    </Button>\n    <Button variant=\"ghost\" type=\"button\" onClick={handleReset}>\n      Reset Form\n    </Button>\n  </div>\n\n  {/* Right: Primary Actions */}\n  <div className=\"flex space-x-3\">\n    {!isFirstStep && (\n      <Button variant=\"outline\" type=\"button\" onClick={onBack}>\n        Back\n      </Button>\n    )}\n    <Button variant=\"primary\" type=\"submit\" isLoading={loading}>\n      {isLastStep ? 'Submit' : 'Continue'}\n    </Button>\n  </div>\n</div>",
      "lineNumber": 6517
    },
    {
      "id": "code-18-6",
      "language": "tsx",
      "code": "// WRONG: Silent validation failures\n<TextField name=\"email\" type=\"email\" />\n\n// CORRECT: Show error messages\n<TextField\n  name=\"email\"\n  type=\"email\"\n  error={!!errors.email}\n  errorMessage={errors.email?.message}\n/>",
      "lineNumber": 6548
    },
    {
      "id": "code-18-7",
      "language": "tsx",
      "code": "// WRONG: No persistence\nconst [formData, setFormData] = useState({});\n\n// CORRECT: Persist to sessionStorage\nuseEffect(() => {\n  sessionStorage.setItem('kyc-draft', JSON.stringify(formData));\n}, [formData]);",
      "lineNumber": 6562
    }
  ],
  "tables": [],
  "content": "## Section 18: Form Composition Patterns\n\n### 18.1 Overview\n\n**Description**: Patterns for composing complex forms with validation, multi-step flows, and field grouping.\n\n**Key Concepts**:\n- Field composition (TextField, FileUpload, OtpInput)\n- Validation state management\n- Multi-step wizards\n- Progress indication\n- Error handling\n\n---\n\n### 18.2 Single-Step Form Pattern\n\n```tsx\nimport { useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport Button from '@/components/ui/Button';\nimport TextField from '@/components/ui/TextField';\nimport Card from '@/components/ui/Card';\nimport { toast } from '@/components/ui/Toast';\n\ninterface ProfileFormData {\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n}\n\nconst ProfileForm = () => {\n  const [loading, setLoading] = useState(false);\n  const { register, handleSubmit, formState: { errors } } = useForm<ProfileFormData>();\n\n  const onSubmit = async (data: ProfileFormData) => {\n    setLoading(true);\n    try {\n      await api.updateProfile(data);\n      toast.show({\n        type: 'success',\n        title: 'Profile Updated',\n        message: 'Your profile has been updated successfully.',\n      });\n    } catch (error) {\n      toast.show({\n        type: 'error',\n        title: 'Update Failed',\n        message: error.message,\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Card variant=\"default\" padding=\"lg\">\n      <h2 className=\"text-2xl font-bold text-white mb-6\">Profile Information</h2>\n\n      <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n        {/* Field Group: Name */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <TextField\n            name=\"firstName\"\n            label=\"First Name\"\n            placeholder=\"John\"\n            error={!!errors.firstName}\n            errorMessage={errors.firstName?.message}\n            {...register('firstName', { required: 'First name is required' })}\n          />\n          <TextField\n            name=\"lastName\"\n            label=\"Last Name\"\n            placeholder=\"Doe\"\n            error={!!errors.lastName}\n            errorMessage={errors.lastName?.message}\n            {...register('lastName', { required: 'Last name is required' })}\n          />\n        </div>\n\n        {/* Field Group: Contact */}\n        <div className=\"space-y-4\">\n          <TextField\n            name=\"email\"\n            label=\"Email Address\"\n            type=\"email\"\n            placeholder=\"john@example.com\"\n            error={!!errors.email}\n            errorMessage={errors.email?.message}\n            {...register('email', {\n              required: 'Email is required',\n              pattern: {\n                value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,\n                message: 'Invalid email address',\n              },\n            })}\n          />\n          <TextField\n            name=\"phone\"\n            label=\"Phone Number\"\n            type=\"tel\"\n            placeholder=\"+91 98765 43210\"\n            error={!!errors.phone}\n            errorMessage={errors.phone?.message}\n            {...register('phone', {\n              required: 'Phone is required',\n              pattern: {\n                value: /^[+]?[0-9]{10,15}$/,\n                message: 'Invalid phone number',\n              },\n            })}\n          />\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex justify-end space-x-3 pt-4\">\n          <Button variant=\"ghost\" type=\"button\">\n            Cancel\n          </Button>\n          <Button variant=\"primary\" type=\"submit\" isLoading={loading}>\n            Save Changes\n          </Button>\n        </div>\n      </form>\n    </Card>\n  );\n};\n```\n\n---\n\n### 18.3 Multi-Step Form Pattern\n\n```tsx\nimport { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ninterface KYCWizardProps {\n  onComplete: (data: KYCData) => void;\n}\n\nconst KYCWizard: React.FC<KYCWizardProps> = ({ onComplete }) => {\n  const [step, setStep] = useState(1);\n  const [formData, setFormData] = useState({});\n\n  const steps = [\n    { id: 1, title: 'Entity Type', component: EntityTypeStep },\n    { id: 2, title: 'Basic Details', component: BasicDetailsStep },\n    { id: 3, title: 'Documents', component: DocumentsStep },\n    { id: 4, title: 'Bank Details', component: BankDetailsStep },\n    { id: 5, title: 'Review', component: ReviewStep },\n  ];\n\n  const currentStep = steps.find(s => s.id === step);\n  const CurrentStepComponent = currentStep?.component;\n\n  const handleNext = (stepData: any) => {\n    setFormData({ ...formData, ...stepData });\n    if (step < steps.length) {\n      setStep(step + 1);\n    } else {\n      onComplete({ ...formData, ...stepData });\n    }\n  };\n\n  const handleBack = () => {\n    if (step > 1) setStep(step - 1);\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n      {/* Progress Indicator */}\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          {steps.map((s, index) => (\n            <div key={s.id} className=\"flex items-center\">\n              <div className={`\n                w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all\n                ${step > s.id\n                  ? 'bg-green-500 text-white'\n                  : step === s.id\n                  ? 'bg-blue-500 text-white ring-4 ring-blue-500/30'\n                  : 'bg-white/10 text-white/50'\n                }\n              `}>\n                {step > s.id ? '✓' : s.id}\n              </div>\n              {index < steps.length - 1 && (\n                <div className={`\n                  w-20 h-1 mx-2 transition-all\n                  ${step > s.id ? 'bg-green-500' : 'bg-white/10'}\n                `} />\n              )}\n            </div>\n          ))}\n        </div>\n        <p className=\"text-center text-white/70\">\n          Step {step} of {steps.length}: {currentStep?.title}\n        </p>\n      </div>\n\n      {/* Step Content */}\n      <AnimatePresence mode=\"wait\">\n        <motion.div\n          key={step}\n          initial={{ opacity: 0, x: 20 }}\n          animate={{ opacity: 1, x: 0 }}\n          exit={{ opacity: 0, x: -20 }}\n          transition={{ duration: 0.3 }}\n        >\n          <Card variant=\"default\" padding=\"lg\">\n            {CurrentStepComponent && (\n              <CurrentStepComponent\n                data={formData}\n                onNext={handleNext}\n                onBack={handleBack}\n                isFirstStep={step === 1}\n                isLastStep={step === steps.length}\n              />\n            )}\n          </Card>\n        </motion.div>\n      </AnimatePresence>\n    </div>\n  );\n};\n```\n\n---\n\n### 18.4 Field Grouping Pattern\n\n```tsx\n// Fieldset component for logical grouping\nconst FieldGroup = ({ title, description, children }) => {\n  return (\n    <div className=\"p-6 bg-white/5 rounded-xl border border-white/10\">\n      <div className=\"mb-4\">\n        <h3 className=\"text-lg font-semibold text-white\">{title}</h3>\n        {description && (\n          <p className=\"text-sm text-white/60 mt-1\">{description}</p>\n        )}\n      </div>\n      <div className=\"space-y-4\">\n        {children}\n      </div>\n    </div>\n  );\n};\n\n// Usage\n<form className=\"space-y-6\">\n  <FieldGroup\n    title=\"Personal Information\"\n    description=\"Your basic details for identification\"\n  >\n    <TextField name=\"fullName\" label=\"Full Name\" />\n    <TextField name=\"dob\" label=\"Date of Birth\" type=\"date\" />\n  </FieldGroup>\n\n  <FieldGroup\n    title=\"Contact Information\"\n    description=\"How we can reach you\"\n  >\n    <TextField name=\"email\" label=\"Email\" type=\"email\" />\n    <TextField name=\"phone\" label=\"Phone\" type=\"tel\" />\n  </FieldGroup>\n\n  <FieldGroup\n    title=\"Address\"\n    description=\"Your residential address\"\n  >\n    <TextField name=\"street\" label=\"Street Address\" />\n    <div className=\"grid grid-cols-2 gap-4\">\n      <TextField name=\"city\" label=\"City\" />\n      <TextField name=\"pincode\" label=\"PIN Code\" />\n    </div>\n  </FieldGroup>\n</form>\n```\n\n---\n\n### 18.5 Validation Patterns\n\n#### Client-Side Validation\n```tsx\n// Using react-hook-form\nimport { useForm } from 'react-hook-form';\n\nconst { register, handleSubmit, formState: { errors }, watch } = useForm({\n  mode: 'onBlur', // Validate on blur\n});\n\n// Field validation rules\n<TextField\n  {...register('pan', {\n    required: 'PAN is required',\n    pattern: {\n      value: /^[A-Z]{5}[0-9]{4}[A-Z]$/,\n      message: 'Invalid PAN format (e.g., ABCDE1234F)',\n    },\n    validate: async (value) => {\n      // Custom async validation\n      const isValid = await api.validatePAN(value);\n      return isValid || 'PAN verification failed';\n    },\n  })}\n/>\n```\n\n#### Real-Time Validation Feedback\n```tsx\nconst PANField = () => {\n  const [isValidating, setIsValidating] = useState(false);\n  const [isValid, setIsValid] = useState<boolean | null>(null);\n\n  const handleValidate = async (value: string) => {\n    if (value.length === 10) {\n      setIsValidating(true);\n      try {\n        const result = await api.validatePAN(value);\n        setIsValid(result.valid);\n      } finally {\n        setIsValidating(false);\n      }\n    }\n  };\n\n  return (\n    <div className=\"relative\">\n      <TextField\n        name=\"pan\"\n        label=\"PAN Number\"\n        placeholder=\"ABCDE1234F\"\n        onChange={(e) => handleValidate(e.target.value)}\n      />\n      {isValidating && (\n        <div className=\"absolute right-3 top-10\">\n          <Loader className=\"h-5 w-5 text-blue-400 animate-spin\" />\n        </div>\n      )}\n      {isValid === true && (\n        <div className=\"absolute right-3 top-10\">\n          <CheckCircle className=\"h-5 w-5 text-green-400\" />\n        </div>\n      )}\n      {isValid === false && (\n        <div className=\"absolute right-3 top-10\">\n          <XCircle className=\"h-5 w-5 text-red-400\" />\n        </div>\n      )}\n    </div>\n  );\n};\n```\n\n---\n\n### 18.6 Form Actions Pattern\n\n```tsx\n<div className=\"flex items-center justify-between pt-6 border-t border-white/10\">\n  {/* Left: Secondary Actions */}\n  <div className=\"flex space-x-3\">\n    <Button variant=\"ghost\" type=\"button\" onClick={handleSaveDraft}>\n      Save Draft\n    </Button>\n    <Button variant=\"ghost\" type=\"button\" onClick={handleReset}>\n      Reset Form\n    </Button>\n  </div>\n\n  {/* Right: Primary Actions */}\n  <div className=\"flex space-x-3\">\n    {!isFirstStep && (\n      <Button variant=\"outline\" type=\"button\" onClick={onBack}>\n        Back\n      </Button>\n    )}\n    <Button variant=\"primary\" type=\"submit\" isLoading={loading}>\n      {isLastStep ? 'Submit' : 'Continue'}\n    </Button>\n  </div>\n</div>\n```\n\n---\n\n### 18.7 Anti-Patterns\n\n❌ **No Validation Feedback**\n```tsx\n// WRONG: Silent validation failures\n<TextField name=\"email\" type=\"email\" />\n\n// CORRECT: Show error messages\n<TextField\n  name=\"email\"\n  type=\"email\"\n  error={!!errors.email}\n  errorMessage={errors.email?.message}\n/>\n```\n\n❌ **Losing Form Data on Navigation**\n```tsx\n// WRONG: No persistence\nconst [formData, setFormData] = useState({});\n\n// CORRECT: Persist to sessionStorage\nuseEffect(() => {\n  sessionStorage.setItem('kyc-draft', JSON.stringify(formData));\n}, [formData]);\n```\n\n---\n"
}